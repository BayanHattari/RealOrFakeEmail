<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Email Phishing Awareness Game</title>
  <style>
    .page { display:none; justify-content:center; justify-items:center; width:100%; }
    .page.active { display:block; }
    body{
      margin:0; display:flex; padding:0; height:100vh;
      background-image:url("images/bg.jpg"); background-size:cover; background-position:center; background-repeat:no-repeat;
      font-family:Arial,sans-serif; justify-content:center; align-items:center;
    }
    .container{ background:#357783; padding:20px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1); width:700px; max-width:90%; min-height:300px; }
    .card{
      background:#357783; border-radius:15px; box-shadow:0 6px 15px rgba(0,0,0,0.1);
      padding:30px; width:700px; max-width:90%; min-height:300px; margin:auto; position:relative;
      font-family:'Grant', 'Garet', sans-serif; color:#fbf9f9;
    }
    .logo-left{ margin-top:20px; margin-left:5px; position:absolute; top:15px; left:15px; width:120px; height:auto; }
    .logo-right{ position:absolute; top:15px; right:15px; width:120px; height:auto; }
    h1{ text-align:center; color:#fcfbfb; margin-bottom:50px; font-size:40px; }
    h2{ text-align:center; color:#fcfbfb; }
    .email-box.ltr{
      border:1px solid #408996; border-radius:8px; padding:15px; margin:20px 0; background:#448894;
      text-align:left; direction:ltr; unicode-bidi:plaintext;
    }
    .email-header.ltr{
       margin-bottom:8px; text-align:left; color:#fcfcfc; white-space:pre-wrap; direction:ltr; unicode-bidi:plaintext;
    }
    .email-body.ltr{ line-height:1.5; color:#fdfcfc; text-align:left; direction:ltr; unicode-bidi:plaintext; }
    .buttons{ display:flex; justify-content:center; gap:20px; }
    button{ padding:12px 20px; border:none; border-radius:30px; cursor:pointer; font-size:16px; transition:0.3s; }
    .start-btn{
      display:block; margin:30px auto; padding:15px 60px; font-size:20px; font-weight:bold; border-radius:30px;
      background:#0b4550; color:#fff; cursor:pointer; transition:0.3s;
    }
    .start-btn, .fake, .real, .check-btn{ font-family:'Grant','Garet',sans-serif; }
    #errorFinderPage .email-header.ltr{ text-align:left; color:#fcfcfc; font-weight:normal; margin-bottom:8px; }
    #errorFinderPage .email-body.ltr{ text-align:left; color:#fcfcfc; line-height:1.5; }
    .start-btn:hover{ background:#042e36; }
    .fake{ background:#155a66; color:#fff; } .fake:hover{ background:#09444e; }
    .real{ background:#5b9ba9; color:#fff; } .real:hover{ background:#4a8694; }
    .result{ text-align:center; font-size:18px; font-weight:bold; margin-top:20px; }
    .clickable{ background:none; }
    .highlight{ background-color:#155a66; }
    #resultMsg{ text-align:center; font-weight:bold; font-size:18px; }
    .check-btn{ display:block; margin:20px auto; padding:12px 25px; border:none; border-radius:30px; font-size:16px; background:#0b4550; color:#fff; cursor:pointer; transition:0.3s; }
    .check-btn:hover{ background:#042e36; }
    .play-title{ text-align:center; font-size:25px; font-weight:bold; margin-bottom:25px; margin-top:50px; }
    .instructions li{ font-size:17px; margin-bottom:15px; }
    .excite { font-size: 20px; font-weight: bold; margin-top: 20px; margin-bottom: 30px; margin-right: 23px; color: #fff; }
    .progress{ text-align:center; margin:8px 0 6px; color:#fcfbfb; font-weight:bold; }
    .result-card{
      background:#357783; border-radius:15px; box-shadow:0 6px 15px rgba(0,0,0,0.1);
      padding:30px; width:400px; max-width:90%; min-height:300px; margin:auto; position:relative;
      font-family:'Grant','Garet',sans-serif; color:#fbf9f9; display:flex; flex-direction:column; align-items:center; text-align:center; gap:15px;
    }
    .result-card img{ width:120px; margin-bottom:15px; }
    .main-icon{ margin-top:18px; }
    .title{ font-size:30px; font-weight:bold; }
    .info{ display:flex; justify-content:space-around; }
    .info div{ text-align:center; }
    .info span{ display:block; font-size:18px; font-weight:bold; }
    .btn{ display:inline-block; padding:12px 25px; border-radius:30px; background:#0b4550; color:#fff; font-size:16px; cursor:pointer; transition:0.3s; text-decoration:none; }
    .btn:hover{ opacity:.85; background:#042e36; }
    .victory .title{ color:#77c9ب6; } .failure .title{ color:#dc3545; }
    #resultPage{ direction:ltr; text-align:left; }
    #resultPage .result-card{ align-items:center; }
  </style>
</head>
<body>
  <div id="startPage" class="page active">
    <h1>Real or Fake Email</h1>
    <div class="card">
      <img src="Screenshot_2025-08-29_144629-removebg-preview.png" alt="TechHub Logo" class="logo-left"/>
      <img src="logo_tech_hub_real_or_fake-removebg-preview.png" alt="FCIT Logo" class="logo-right"/>
      <p class="play-title">طريقة اللعب:</p>
      <ul class="instructions">
        <li><b>ستظهر لك رسالة بريد إلكتروني.</b></li>
        <li><b>قرّر هل الرسالة حقيقية أم مزيفة.</b></li>
        <li><b>إذا كانت مزيفة، اختر الأخطاء الثلاثة بالنقر عليها.</b></li>
        <li><b>سيتم تمييز كل خطأ تلقائيًا.</b></li>
      </ul>
      <p class="excite">انقر ابدأ للبدء واختبار مهاراتك ✨ </p>
      <button class="start-btn" onclick="goToEmail()">ابدأ</button>
    </div>
  </div>

  <div id="emailPage" class="page">
    <div class="card">
      <img src="Screenshot_2025-08-29_144629-removebg-preview.png" alt="TechHub Logo" class="logo-left"/>
      <img src="logo_tech_hub_real_or_fake-removebg-preview.png" alt="FCIT Logo" class="logo-right"/>
      <h1>البريد الإلكتروني</h1>
      <div id="progress" class="progress"></div>
      <div class="email-box ltr">
        <div class="email-header ltr" id="emailHeader"></div>
        <div class="email-body ltr" id="emailBody"></div>
      </div>
      <div class="buttons">
        <button class="fake" onclick="checkAnswer('مزيفة')">مزيف</button>
        <button class="real" onclick="checkAnswer('حقيقية')">حقيقي</button>
      </div>
      <div class="result" id="result"></div>
    </div>
  </div>

  <div id="errorFinderPage" class="page">
    <div class="card">
      <img src="Screenshot_2025-08-29_144629-removebg-preview.png" alt="TechHub Logo" class="logo-left"/>
      <img src="logo_tech_hub_real_or_fake-removebg-preview.png" alt="FCIT Logo" class="logo-right"/>
      <h2>اكتشف الأخطاء الثلاثة في هذا البريد</h2>
      <div class="email-box ltr" id="errorBox"></div>
      <button class="check-btn" onclick="checkAnswers()">تحقق</button>
      <p id="resultMsg"></p>
    </div>
  </div>

  <div id="resultPage" class="page">
    <div class="result-card" id="resultCard">
      <img src="Screenshot_2025-08-29_144629-removebg-preview.png" class="logo-left"/>
      <img src="logo_tech_hub_real_or_fake-removebg-preview.png" class="logo-right"/>
      <img src="https://cdn.pixabay.com/photo/2021/04/27/21/30/trophy-6212557_960_720.png" class="main-icon"/>
      <div class="title">Victory!</div>
      <p>You got "" out of 5 correct!</p>
      <div class="info"><div><span>Golden Medal</span>Achievement</div></div>
      <a href="#" class="btn" onclick="restartGame()">Take Another Test</a>
    </div>
  </div>

  <script>
    const GAS_ENDPOINT = 'https://script.google.com/macros/s/AKfycbyPnKGg9_-4YYaxkQDiljI7tQ3dGD1iYBBxiiQRjp9w9tj9ty5IcBtNRMYAF6GuKevwug/exec';
    const GAME_VERSION = 'phishing-v1';
    const VICTORY_THRESHOLD = 3;

    let fakeCorrect = 0;
    let sessionId   = cryptoRandomId();

    function cryptoRandomId(){
      return 'sess-' + Math.random().toString(36).slice(2) + Date.now().toString(36);
    }

    async function sendStatsToSheet(payload){
      try{
        await fetch(GAS_ENDPOINT, {
          method: 'POST',
          headers: { 'Content-Type': 'text/plain;charset=utf-8' },
          body: JSON.stringify(payload)
        });
      }catch(err){
        console.error('Failed to send to Google Sheets:', err);
      }
    }

    const EMAIL_POOL = [
      { from:"support@micros0ft.com", subject:"Account Review Required", content:"Hello David, please review your account security by visiting http://micros0ft.secure-login.com. Your account will be restricted soon.", type:"مزيفة", Flags:["micros0ft.com","http://micros0ft.secure-login.com","restricted soon"] },
      { from:"linda.smith@gmail.com", subject:"Weekend Plans", content:"Are we still on for hiking this Saturday?", type:"حقيقية" },
      { from:"it-support@securebank.com", subject:"Password Expiring", content:"Your password expires today. Reset it now via http://securebank-reset.com to prevent login issues.", type:"مزيفة", Flags:["expires today","Reset it now","http://securebank-reset.com"] },
      { from:"winer@lottery-prizes.com", subject:"Wow! You’ve Been Selected", content:"Congratulations! You won $5,000. Provide your bank details to claim your prize.", type:"مزيفة", Flags:["winer","Provide your bank details","$5,000"] },
      { from:"admin@university.edu", subject:"Course Registration", content:"Reminder: The registration portal is open for the new semester.", type:"حقيقية" },
      { from:"admin@paypal.com", subject:"Urgent: Account Fix", content:"Your PayPal account is blocked. Pay $10 and reply with your password to unloc it.", type:"مزيفة", Flags:["Pay $10","reply with your password","unloc it"] },
      { from:"hr@company.com", subject:"Interview Invitation", content:"We are pleased to invite you to an interview this Thursday at 2 PM.", type:"حقيقية" },
      { from:"helpdesk@techhub.co", subject:"Reset Required", content:"Security alert. Send your OTP, username, and forward this email to confirm.", type:"مزيفة", Flags:["Send your OTP","username","forward this email"] },
      { from:"no-reply@conference.org", subject:"Session Reminder", content:"Your session starts at 11:30 AM in Hall B.", type:"حقيقية" },
      { from:"support@insta-help.net", subject:"Account Warning", content:"We noticed unusual activity. Provide your password, backup codes, and turn off 2FA.", type:"مزيفة", Flags:["Provide your password","backup codes","turn off 2FA"] },
      { from:"billing@service.com", subject:"Invoice Paid", content:"Thank you for your payment. The invoice is available in your account portal.", type:"حقيقية" },
      { from:"info@techhub.sa", subject:"Tech Convention Pass", content:"Your registration for TechHub convention is confirmed. Bring your confirmation code at entry.", type:"حقيقية" },
      { from:"giveaway@amazon-prize.com", subject:"You Won!", content:"Enter your card number and CVV to receive your prize immediately.", type:"مزيفة", Flags:["Enter your card number","CVV","immediately"] },
      { from:"security@bank-secure.com", subject:"Account Suspended", content:"Verify your pasword here within 30 minutes or your account will be closed.", type:"مزيفة", Flags:["Verify your pasword","30 minutes","account will be closed"] },
      { from:"library@uni.edu", subject:"Book Ready", content:"Your reserved book is ready for pickup at the library desk.", type:"حقيقية" }
    ];

    let selectedEmails = [];
    let currentEmailIndex = 0, score = 0, currentEmail = null, selectedErrors = new Set();
    let answering = false;
    let errorLocked = false;

    function setAnswerButtonsDisabled(disabled){
      document.querySelectorAll('#emailPage .buttons button').forEach(b=>b.disabled = disabled);
    }

    function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }
    function pickFiveRandom(){ const copy = EMAIL_POOL.slice(); shuffle(copy); return copy.slice(0,5); }

    function goToEmail(){
      selectedEmails = pickFiveRandom();
      currentEmailIndex = 0;
      score = 0;
      fakeCorrect = 0;
      loadEmail();
      showPage("emailPage");
    }

    function loadEmail(){
      if(currentEmailIndex >= 5){
        localStorage.setItem("finalScore", score);
        localStorage.setItem("totalQuestions", 5);
        showPage("resultPage");
        renderResult();
        return;
      }
      currentEmail = selectedEmails[currentEmailIndex];
      document.getElementById("progress").innerText = `السؤال ${currentEmailIndex + 1} من 5`;
      document.getElementById("emailHeader").innerText = `From: ${currentEmail.from}\n\nSubject: ${currentEmail.subject}\n\n`;
      document.getElementById("emailBody").innerText = currentEmail.content;
      document.getElementById("result").innerText = "";
      answering = false;
      setAnswerButtonsDisabled(false);
    }

    function checkAnswer(answer) {
      if (answering) return;
      answering = true;
      setAnswerButtonsDisabled(true);

      if (answer === currentEmail.type) {
        score += 1;
        if (answer === 'مزيفة') {
          goToErrorFinder();
          return;
        }
        document.getElementById("result").style.color = "#77c9b6";
        document.getElementById("result").innerText = "✅ صحيح! هذه الرسالة " + currentEmail.type.toUpperCase();
      } else {
        document.getElementById("result").style.color = "red";
        document.getElementById("result").innerText = "❌ خطأ! هذه الرسالة " + currentEmail.type.toUpperCase();
      }

      currentEmailIndex++;
      setTimeout(loadEmail, 1500);
    }

    function goToErrorFinder(){
      showPage("errorFinderPage");
      const box = document.getElementById("errorBox");
      const headerHtml = `From: ${makeClickable(currentEmail.from)}\n\nSubject: ${currentEmail.subject}\n\n`;
      const bodyHtml   = makeClickable(currentEmail.content);
      box.innerHTML = `
        <div class="email-header ltr">${headerHtml}</div>
        <div class="email-body ltr">${bodyHtml}</div>
      `;
      selectedErrors.clear();
      document.getElementById("resultMsg").innerText = "";
      errorLocked = false;
    }

    function makeClickable(text){
      if(!currentEmail.Flags) return text;
      let result = text;
      currentEmail.Flags.forEach(flag=>{
        const regex = new RegExp(flag.replace(/[.*+?^${}()|[\]\\]/g, "\\$&"), "g");
        result = result.replace(regex, `<span class="clickable" onclick="toggleHighlight(this)">${flag}</span>`);
      });
      return result;
    }

    function toggleHighlight(el){
      const text = el.innerText;
      if(selectedErrors.has(text)){ selectedErrors.delete(text); el.classList.remove("highlight"); }
      else{ selectedErrors.add(text); el.classList.add("highlight"); }
    }

    function checkAnswers(){
      if (errorLocked) return;
      const result = document.getElementById("resultMsg");
      if(selectedErrors.size === 3){
        result.innerHTML = "👏 ممتاز. اكتشفت كل الأخطاء.";
        result.style.color = "#77c9b6";
        fakeCorrect += 1;
        errorLocked = true;
        setTimeout(()=>{
          currentEmailIndex++;
          showPage("emailPage");
          loadEmail();
        }, 900);
      }else{
        result.innerHTML = `❌ حاول مرة أخرى. اكتشفت ${selectedErrors.size} من 3.`;
        result.style.color = "red";
      }
    }

    function showPage(id){
      document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
      document.getElementById(id).classList.add("active");
    }

    function renderResult(){
      const correct = parseInt(localStorage.getItem("finalScore")) || 0;
      const total   = parseInt(localStorage.getItem("totalQuestions")) || 0;
      const isVictory = correct >= VICTORY_THRESHOLD;

      const accuracy = total > 0 ? (correct / total) : 0;
      const wins  = isVictory ? 1 : 0;
      const losses = isVictory ? 0 : 1;

      sendStatsToSheet({
        player: '',
        correct, total, accuracy, wins, losses,
        fakeRoundsSolved: fakeCorrect,
        sessionId, gameVersion: GAME_VERSION
      });

      const card = document.getElementById("resultCard");
      card.classList.remove("victory","failure");

      if(isVictory){
        card.classList.add("victory");
        card.innerHTML = `
          <img src="Screenshot_2025-08-29_144629-removebg-preview.png" class="logo-left"/>
          <img src="logo_tech_hub_real_or_fake-removebg-preview.png" class="logo-right"/>
          <img src="https://cdn.pixabay.com/photo/2021/04/27/21/30/trophy-6212557_960_720.png" class="main-icon"/>
          <div class="title">! نجحت</div>
          <p>🎉 حصلت على ${correct} من أصل ${total} إجابات صحيحة</p>
          <div class="info"><div><span>👏 أحسنت</span></div></div>
          <a href="#" class="btn" onclick="restartGame()">أجرِ اختبارًا آخر</a>
        `;
      }else{
        card.classList.add("failure");
        card.innerHTML = `
          <img src="Screenshot_2025-08-29_144629-removebg-preview.png" class="logo-left"/>
          <img src="logo_tech_hub_real_or_fake-removebg-preview.png" class="logo-right"/>
          <img src="https://cdn-icons-png.flaticon.com/512/564/564619.png" class="main-icon"/>
          <div class="title">فشلت</div>
          <p>حصلت على ${correct} من أصل ${total} إجابات صحيحة</p>
          <div class="info"><div><span>حظًا أوفر</span></div></div>
          <a href="#" class="btn" onclick="restartGame()">أجرِ اختبارًا آخر</a>
        `;
      }
    }

    function restartGame(){
      currentEmailIndex = 0;
      score = 0;
      fakeCorrect = 0;
      sessionId = cryptoRandomId();
      localStorage.clear();
      showPage("startPage");
    }
  </script>
</body>
</html>
